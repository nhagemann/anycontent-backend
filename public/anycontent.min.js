/*! anycontent 2023-07-26 */

function cmck_modal_id(t,e,i){t="#"+t,$(t).off("shown.bs.modal"),$(t).on("shown.bs.modal",function(){"function"==typeof i&&i()}),void 0!==e&&($(t).removeData(),$(t+" .modal-header").html(""),$(t+" .modal-body").html(""),$(t+" .modal-footer").html("")),$(t).appendTo("body"),$(t).modal({keyboard:!0}),$(t).load(e)}function cmck_modal(t,e){cmck_modal_id("modal_edit",t,e)}function cmck_modal_id_hide(t){t="#"+t,$(t).modal("hide")}function cmck_modal_hide(){cmck_modal_id_hide("modal_edit")}function cmck_modal_set_property(t,e){$("#form_edit [name="+t+"]").val(e)}function cmck_set_var(t,e){"object"!=typeof $.cmck&&($.cmck={}),$.cmck[t]=e}function cmck_get_var(t,e){return $.cmck[t]}function cmck_trigger_change(i){$(i).trigger("change"),$("iframe").each(function(t,e){"function"==typeof e.contentWindow.cmck_sequence_trigger_change&&e.contentWindow.cmck_sequence_trigger_change(i)})}function cmck_message_info(t){$("#messages").html('<div class="alert alert-info">'+t+"</div>"),$(document).scrollTop(0),$("#messages div").delay(3e3).fadeOut(500)}function cmck_message_alert(t){$("#messages").html('<div class="alert alert-warning">'+t+"</div>"),$(document).scrollTop(0),$("#messages div").delay(3e3).fadeOut(500)}function cmck_message_error(t){$("#messages").html('<div class="alert alert-danger">'+t+"</div>"),$(document).scrollTop(0),$("#messages div").delay(3e3).fadeOut(500)}function cmck_get_cookie(t){var e=window.document.cookie.split(t+"=");if(2==e.length)return e.pop().split(";").shift()}function cmck_delete_cookie(t){document.cookie=encodeURIComponent(t)+"=deleted; expires="+new Date(0).toUTCString()}function cmck_document(){return document}function cmck_sequence_trigger_change(t){$(t).trigger("change")}$(function(){$.widget("custom.autocompleteCat",$.ui.autocomplete,{_create:function(){this._super(),this.widget().menu("option","items","> :not(.ui-autocomplete-category)")},_renderMenu:function(n,t){var o=this,a="";$.each(t,function(t,e){var i;e.category!=a&&(void 0!==e.category&&n.append("<li class='ui-autocomplete-category'>"+e.category+"</li>"),a=e.category),i=o._renderItemData(n,e),e.category&&i.attr("aria-label",e.category+" : "+e.label)})}})}),$(document).on("cmck",function(t,e){switch(e.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":$(".formelement-popover").popover({html:!0}),$(".formelement-tooltip").popover({html:!0})}}),$(document).ready(function(){}),$(document).on("cmck",function(t,e){switch(e.type){case"editform.setProperty":$("#form_edit [name="+e.property+"]").val(e.value),1==e.save&&0==parseInt($("#form_edit").attr("data-event-countdown"))&&$("#form_edit").submit()}}),$(document).ready(function(){$("#form_edit_button_save_options a").click(function(){return $("#form_edit_button_save").removeClass("open"),$("#form_edit_button_save input:first").attr("value",$(this).text()),$("#form_edit_button_save_operation").attr("value",$(this).attr("data-operation")),!1}),$("#form_edit_button_submit").click(function(){return $.event.trigger("cmck",{type:"editform.Save"}),$("#form_edit").submit(),!1}),$("#form_edit").submit(function(){return countdown=parseInt($("#form_edit").attr("data-event-countdown")),0==countdown&&(counterrors=0,$(".form-group.mandatory").each(function(){$(this).removeClass("has-error"),idFormelement=$(this).attr("data-formelement"),val="",$('[id^="'+idFormelement+'"]').each(function(){val+=$(this).val().trim(),console.log(val)}),""==val&&($(this).addClass("has-error"),counterrors++)}),0<counterrors?cmck_message_alert("Please fill in all required fields."):($.blockUI({message:null}),$.post($("#form_edit").attr("action"),$("#form_edit").serialize()).fail(function(t){cmck_message_error("Failed to save record. Please try again later or contact your administrator."),$.unblockUI()}).done(function(t){if(null!=t.success){if(1==t.success)return location.href=t.redirect,!1;if(null!=t.message){if(null!=t.error&&1==t.error?cmck_message_error(t.message):cmck_message_alert(t.message),null!=t.properties)for(i=0;i<t.properties.length;i++)property=t.properties[i],input=$('input[name="'+property+'"]'),id=input.attr("id"),$('div.form-group[data-formelement="'+id+'"]').addClass("has-error");return $.unblockUI(),!1}}cmck_message_error("Failed to save record. Please try again later or contact your administrator."),$.unblockUI()})),!1)}),$(".button_delete").click(function(){var e=$(this).attr("href");return bootbox.confirm("Are you sure?",function(t){t&&(document.location=e)}),!1}),$("#form_edit_button_transfer").click(function(){return cmck_modal($(this).attr("href")),!1}),$(document).keydown(function(t){return"115"!=t.which&&"83"!=t.which||!t.ctrlKey&&!t.metaKey||(t.preventDefault(),$("#form_edit_button_submit").click(),!1)}),$.event.trigger("cmck",{type:"editForm.init"})}),function(a){a.fn.cmck_editsequence=function(){var t=!0,o=function(){init=0,a(".sequence-item").each(function(){a(this).height()>init&&(init=a(this).height())}),c=a("div.sequence-item").length,init+=35*c,c=a("ul.sequence-add-item").first().find("li").length,init+=40*c,init+=50,h=Math.max(200,init),iframe="#form_edit_sequence_"+a("#form_sequence").attr("data-property")+"_iframe",t?(a(iframe,window.parent.document).height(h),t=!1):a(iframe,window.parent.document).animate({height:h+"px"},500)};a(document).on("cmck",function(t,e){var i;switch(e.type){case"sequenceForm.init":case"sequenceForm.refresh":"sequenceForm.refresh"==e.type&&(a(".sequence-accordion").accordion("destroy"),a(".sequence-add-item li a").off("click"),a(".sequence-remove-item").off("click"),a(".sequence-accordion").sortable("refresh")),a(".sequence-accordion").accordion({header:".accordionTitle",collapsible:!0,heightStyle:"content",active:parseInt(a("#form_sequence").attr("data-active-item")),activate:function(){o()},animated:"fastslide"}),"sequenceForm.init"==e.type&&a(".sequence-accordion").sortable({axis:"y",handle:".accordionTitle",stop:function(t,e){e.item.children(".accordionTitle").triggerHandler("focusout")}}),a(".sequence-add-item li a").click(function(){insert=a(this).attr("data-insert"),i=a(this).closest("ul").attr("data-item"),a.event.trigger("cmck",{type:"sequenceForm.add",insert:insert,item:i})}),a(".sequence-remove-item").click(function(){i=a(this).attr("data-item"),a.event.trigger("cmck",{type:"sequenceForm.remove",item:i})}),o();break;case"sequenceForm.add":count=parseInt(a("#form_sequence").attr("data-count"))+1,a("#form_sequence").attr("data-count",count),a.get(a("#form_sequence").attr("data-action-add")+"?insert="+e.insert+"&count="+count,function(t){i=e.item,0<parseInt(i)?(a("#form_sequence_item_"+i).after(t),n=a("div.sequence-item").index(a("#form_sequence_item_"+i))+1):(a(".sequence-accordion").append(t),n=a("div.sequence-item").length-1),a("#form_sequence").attr("data-active-item",n),a.event.trigger("cmck",{type:"sequenceForm.refresh"})});break;case"sequenceForm.remove":i=parseInt(e.item),n=a("div.sequence-item").index(a("#form_sequence_item_"+i)),a("#form_sequence_item_"+i).remove(),n==a("div.sequence-item").length&&(n-=1),a("#form_sequence").attr("data-active-item",n),a.event.trigger("cmck",{type:"editForm.init",refresh:!0})}}),a.event.trigger("cmck",{type:"sequenceForm.init"})},a(document).ready(function(){a(document).cmck_editsequence()})}(jQuery),function(i){i(document).on("cmck",function(t,e){switch(e.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":i(".datepicker").each(function(){i(this).datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showWeek:!1,firstDay:1,numberOfMonths:1,showButtonPanel:!1})})}})}(jQuery),function(n){n.fn.cmck_fe_email=function(){var i=function(t){if(n(this).removeClass("alert-success"),n(this).removeClass("alert-danger"),email=n(this).val(),""!=email){var e=n(this);i=email,/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(i)?(e.addClass("alert-success"),e.removeClass("alert-danger")):(e.addClass("alert-danger"),e.removeClass("alert-success"))}var i};n(document).on("cmck",function(t,e){switch(e.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":n("div.formelement-email input").each(function(){val=n(this).val(),n(this).on("focus",i),n(this).on("blur",i)})}})},n(document).cmck_fe_email()}(jQuery),function(n){n.fn.cmck_fe_link=function(){var i=function(t){if(n(this).removeClass("alert-success"),n(this).removeClass("alert-danger"),url=n(this).val(),""!=url){var e=n(this);n.ajax({url:"/anycontent/formelement/link/check?url="+url,success:function(t){e.removeClass("alert-success"),e.removeClass("alert-warning"),e.removeClass("alert-danger"),200==t?e.addClass("alert-success"):400<t||0===t?e.addClass("alert-danger"):e.addClass("alert-warning")}})}};n(document).on("cmck",function(t,e){switch(e.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":n("div.formelement-link input").each(function(){n(this).off("blur"),n(this).on("blur",i)})}})},n(document).cmck_fe_link()}(jQuery),function(i){i(document).on("cmck",function(t,e){switch(e.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":i(".formelement-password input[type=text]").each(function(){i(this).change(function(){i(this).next("input[type=hidden]").val(1)})}),i(".formelement-password-generate-button").each(function(){i(this).click(function(){target=i(this).attr("data-target"),i(target).val(Math.random().toString(36).slice(-8)),i(target).next("input[type=hidden]").val(1)})}),i(".formelement-password-clear-button").each(function(){i(this).click(function(){target=i(this).attr("data-target"),i(target).val(""),i(target).next("input[type=hidden]").val(1),alert("Password cleared.")})})}})}(jQuery),function(i){i(document).on("cmck",function(t,e){switch(e.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":i(".formelement-color input").minicolors({control:"wheel",letterCase:"uppercase",theme:"bootstrap"}),i(".formelement-color select").on("change",function(){value=i(this).val(),value.replace(/[^0-9A-F]/g,""),target=i(this).attr("data-target"),i("#"+target).minicolors("value",value)})}})}(jQuery),$(document).ready(function(){$("#form_files_button_create_folder").click(function(){return $("#modal_files_create_folder").modal({}),!1}),$("#form_files_button_upload_file").click(function(){return $("#modal_files_upload_file").modal({}),!1}),$("#form_files_button_delete_folder").click(function(){return $("#modal_files_delete_folder").modal({}),!1}),$(".files-file-zoom").click(function(){$("#modal_files_file_zoom_title").html($(this).attr("data-title")),$("#modal_files_file_zoom_iframe").attr("src",$(this).attr("href"));return $("#modal_files_file_zoom").modal({keyboard:!0}),!1}),$(".files-file-edit").click(function(){$("#modal_files_file_original_id").val($(this).attr("data-title")),$("#modal_files_file_rename_id").val($(this).attr("data-title"));return $("#modal_files_file_edit").modal({keyboard:!0}),!1}),$(".files-delete-file").click(function(){$("#modal_files_file_delete_title").html($(this).attr("data-title")),$("#modal_files_file_delete_id").val($(this).attr("data-title"));return $("#modal_files_delete_file").modal({keyboard:!0}),!1})}),function(t){t(".formelement-reference select").on("change",function(){value=t(this).val(),button=t("#"+t(this).attr("id")+"_edit_button"),""!=value?(t(button).removeClass("disabled"),url=t(button).attr("data-url"),console.log(url),url=url.replace("recordId",value),t(button).attr("href",url)):t(button).addClass("disabled")})}(jQuery),function(n){n(document).on("cmck",function(t,e){switch(e.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":n(".formelement-file-modal-button").off(),n(".formelement-file-modal-button").click(function(){var t=n(n(this).attr("data-input"));return parent.cmck_set_var("fe_file_property",t),parent.cmck_modal(n(this).attr("href")),!1}),n(".formelement-file-modal-button-view").off(),n(".formelement-file-modal-button-view").click(function(){var t=n(this).attr("data-input"),e=n(t).val();n(parent.document).find("#modal_files_file_zoom_title").html(e);var i=n(t).attr("data-url-view")+e;return n(parent.document).find("#modal_files_file_zoom_iframe").attr("src",i),n.ajax({url:i,type:"HEAD"}).always(function(t){null!=t&&404==t.status?alert("File not found. Please check file path."):parent.cmck_modal_id("modal_files_file_zoom"),parent.cmck_modal_id("modal_files_file_zoom")}),!1}),n(".formelement-file-modal-button-download").off(),n(".formelement-file-modal-button-download").click(function(){var t=n(this).attr("data-input"),e=n(t).val();return""!=e.trim()&&(e=n(this).attr("href")+e,n.ajax({url:e,type:"HEAD"}).always(function(t){if(null==t||404!=t.status)return window.location.href=e,!1;alert("File not found. Please check file path.")})),!1}),n(".formelement-file input, .formelement-image input").on("change",function(){var t="#"+n(this).attr("id")+"_preview",e=n(this).val();if(n(t).hide(),n(t+" a").attr("href",""),n(t+" img").attr("src",""),e&&null!=e.toLowerCase().match(/\.(jpeg|jpg|gif|png)$/)){var i=n(this).attr("data-url-view")+e;n.ajax({url:i,type:"HEAD",error:function(){n(t).hide()},success:function(){n(t).show(),n(t+" a").attr("href",i),n(t+" img").attr("src",i)}})}})}})}(jQuery),$(document).on("cmck",function(t,e){switch(e.type){case"editForm.init":case"sequenceForm.init":case"sequenceForm.refresh":$("div.formelement-richtext textarea").each(function(){id=$(this).attr("id"),rows=$(this).attr("rows"),h=90+18*rows,readonly=!1,"disabled"==$(this).attr("disabled")&&(readonly=!0),tinymce.init({selector:"#"+id,height:h,setup:function(t){t.on("change",function(){tinymce.triggerSave()})},readonly:readonly,plugins:["code","link","anchor"],toolbar:"undo redo | bold italic | bullist numlist | link unlink anchor | styleselect |  alignleft aligncenter alignright alignjustify | indent outdent | removeformat | code  ",style_formats:[{title:"Headers",items:[{title:"Header 1",format:"h1"},{title:"Header 2",format:"h2"},{title:"Header 3",format:"h3"},{title:"Header 4",format:"h4"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}]})})}}),$(document).ready(function(){$(document).on("cmck",function(t,e){switch(e.type){case"editform.Save":$(".sequence-iframe").each(function(){var e=$(this).contents().find("#form_sequence");$("#form_edit").attr("data-event-countdown",parseInt($("#form_edit").attr("data-event-countdown"))+1),$.post($(e).attr("action"),$(e).serialize(),function(t){$("#form_edit").attr("data-event-countdown",parseInt($("#form_edit").attr("data-event-countdown"))-1),$.event.trigger("cmck",{type:"editform.setProperty",property:$(e).attr("data-property"),value:JSON.stringify(t.sequence),save:!0})},"json")})}})}),function(l){l.fn.cmck_fe_table=function(){var r=function(){l(".formelement-table tbody").sortable({handle:".handle"}),l(".formelement-table td").click(function(){l(this).children("textarea").focus()}),l(".formelement-table a[data-action=plus]").click(function(){var t=a(this),e=s(this);return c(e,t),!1}),l(".formelement-table a[data-action=minus]").click(function(){var t=a(this),e=s(this);return i(e,t),!1}),l(".formelement-table textarea").keydown(function(t){if(9===t.keyCode){var e=l(this).closest("tr").nextAll().length,i=l(this).closest("td").nextAll().length;if(0==e&&1==i){var n=a(this),o=s(this);c(o,n)}}}),l(".formelement-table table").each(function(t){n(l(this).attr("name"))})},a=function(t){var e=l(t).closest("table"),i=l(t).closest("tr"),n=l(e).find("tr");return l(n).index(i)},s=function(t){var e=l(t).closest("table");return l(e).attr("name")},c=function(t,e){var i=parseInt(l("table[name="+t+"]").attr("data-rows"));l("table[name="+t+"]").attr("data-rows",++i);var n=l("table[name="+t+"] th").length-2,o='<tr><td class="handle" width="2%">'+i+"</td>";o+=Array(n+1).join('<td><textarea name="'+t+'[]"></textarea></td>'),o+='<td width="3%"><a class="btn btn-default btn-xs" href="#" tabindex="-1" data-action="plus">+</button></a>  <a class="btn btn-default btn-xs" href="#" tabindex="-1" data-action="minus">-</button></a></td></tr>';var a=l("table[name="+t+"]").find("tr");row=a[e],l(row).after(o),l(".formelement-table a").off(),r()},i=function(t,e){var i=l("table[name="+t+"]").find("tr");row=i[e],l(row).remove(),n(t)},n=function(t){var e=l("table[name="+t+"] a[data-action=minus]");l(e).each(function(t){l(this).show()}),1==e.length&&l(e[0]).hide()};l(document).on("cmck",function(t,e){e.type}),r()},l(document).ready(function(){l(document).cmck_fe_table()})}(jQuery),$(document).ready(function(){$("#listing_button_import").click(function(){return cmck_modal($(this).attr("href")),!1}),$("#listing_button_export").click(function(){return cmck_modal($(this).attr("href")),!1})}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(function(k){"use strict";function i(t){var e=t.parent();t.removeData("minicolors-initialized").removeData("minicolors-settings").removeProp("size").removeClass("minicolors-input"),e.before(t).remove()}function n(t){var e=t.parent(),i=e.find(".minicolors-panel"),n=t.data("minicolors-settings");!t.data("minicolors-initialized")||t.prop("disabled")||e.hasClass("minicolors-inline")||e.hasClass("minicolors-focus")||(o(),e.addClass("minicolors-focus"),i.animate?i.stop(!0,!0).fadeIn(n.showSpeed,function(){n.show&&n.show.call(t.get(0))}):(i.show(),n.show&&n.show.call(t.get(0))))}function o(){k(".minicolors-focus").each(function(){var t=k(this),e=t.find(".minicolors-input"),i=t.find(".minicolors-panel"),n=e.data("minicolors-settings");i.animate?i.fadeOut(n.hideSpeed,function(){n.hide&&n.hide.call(e.get(0)),t.removeClass("minicolors-focus")}):(i.hide(),n.hide&&n.hide.call(e.get(0)),t.removeClass("minicolors-focus"))})}function a(t,e,i){var n,o,a,r,s,c=t.parents(".minicolors").find(".minicolors-input"),l=c.data("minicolors-settings"),d=t.find("[class$=-picker]"),u=t.offset().left,m=t.offset().top,f=Math.round(e.pageX-u),h=Math.round(e.pageY-m),p=i?l.animationSpeed:0;e.originalEvent.changedTouches&&(f=e.originalEvent.changedTouches[0].pageX-u,h=e.originalEvent.changedTouches[0].pageY-m),f<0&&(f=0),h<0&&(h=0),f>t.width()&&(f=t.width()),h>t.height()&&(h=t.height()),t.parent().is(".minicolors-slider-wheel")&&d.parent().is(".minicolors-grid")&&(n=75-f,o=75-h,a=Math.sqrt(n*n+o*o),(r=Math.atan2(o,n))<0&&(r+=2*Math.PI),75<a&&(f=(a=75)-75*Math.cos(r),h=75-75*Math.sin(r)),f=Math.round(f),h=Math.round(h)),s={top:h+"px"},t.is(".minicolors-grid")&&(s.left=f+"px"),d.animate?d.stop(!0).animate(s,p,l.animationEasing,function(){g(c,t)}):(d.css(s),g(c,t))}function g(t,e){function i(t,e){var i,n;return t.length&&e?(i=t.offset().left,n=t.offset().top,{x:i-e.offset().left+t.outerWidth()/2,y:n-e.offset().top+t.outerHeight()/2}):null}var n,o,a,r,s,c,l,d=t.val(),u=t.attr("data-opacity"),m=t.parent(),f=t.data("minicolors-settings"),h=m.find(".minicolors-input-swatch"),p=m.find(".minicolors-grid"),g=m.find(".minicolors-slider"),v=m.find(".minicolors-opacity-slider"),_=p.find("[class$=-picker]"),b=g.find("[class$=-picker]"),y=v.find("[class$=-picker]"),k=i(_,p),w=i(b,g),$=i(y,v);if(e.is(".minicolors-grid, .minicolors-slider, .minicolors-opacity-slider")){switch(f.control){case"wheel":r=p.width()/2-k.x,s=p.height()/2-k.y,c=Math.sqrt(r*r+s*s),(l=Math.atan2(s,r))<0&&(l+=2*Math.PI),75<c&&(c=75,k.x=69-75*Math.cos(l),k.y=69-75*Math.sin(l)),o=M(c/.75,0,100),d=z({h:n=M(180*l/Math.PI,0,360),s:o,b:a=M(100-Math.floor(w.y*(100/g.height())),0,100)}),g.css("backgroundColor",z({h:n,s:o,b:100}));break;case"saturation":d=z({h:n=M(parseInt(k.x*(360/p.width()),10),0,360),s:o=M(100-Math.floor(w.y*(100/g.height())),0,100),b:a=M(100-Math.floor(k.y*(100/p.height())),0,100)}),g.css("backgroundColor",z({h:n,s:100,b:a})),m.find(".minicolors-grid-inner").css("opacity",o/100);break;case"brightness":d=z({h:n=M(parseInt(k.x*(360/p.width()),10),0,360),s:o=M(100-Math.floor(k.y*(100/p.height())),0,100),b:a=M(100-Math.floor(w.y*(100/g.height())),0,100)}),g.css("backgroundColor",z({h:n,s:o,b:100})),m.find(".minicolors-grid-inner").css("opacity",1-a/100);break;default:d=z({h:n=M(360-parseInt(w.y*(360/g.height()),10),0,360),s:o=M(Math.floor(k.x*(100/p.width())),0,100),b:a=M(100-Math.floor(k.y*(100/p.height())),0,100)}),p.css("backgroundColor",z({h:n,s:100,b:100}))}q(t,d,u=f.opacity?parseFloat(1-$.y/v.height()).toFixed(2):1)}else h.find("span").css({backgroundColor:d,opacity:String(u)}),C(t,d,u)}function q(t,e,i){var n,o=t.parent(),a=t.data("minicolors-settings"),r=o.find(".minicolors-input-swatch");a.opacity&&t.attr("data-opacity",i),e="rgb"===a.format?(n=S(e)?x(e,!0):D($(e,!0)),i=""===t.attr("data-opacity")?1:M(parseFloat(t.attr("data-opacity")).toFixed(2),0,1),!isNaN(i)&&a.opacity||(i=1),t.minicolors("rgbObject").a<=1&&n&&a.opacity?"rgba("+n.r+", "+n.g+", "+n.b+", "+parseFloat(i)+")":"rgb("+n.r+", "+n.g+", "+n.b+")"):(S(e)&&(e=j(e)),w(e,a.letterCase)),t.val(e),r.find("span").css({backgroundColor:e,opacity:String(i)}),C(t,e,i)}function u(t,e){var i,n,o,a,r,s,c,l,d,u,m=t.parent(),f=t.data("minicolors-settings"),h=m.find(".minicolors-input-swatch"),p=m.find(".minicolors-grid"),g=m.find(".minicolors-slider"),v=m.find(".minicolors-opacity-slider"),_=p.find("[class$=-picker]"),b=g.find("[class$=-picker]"),y=v.find("[class$=-picker]");switch(S(t.val())?(i=j(t.val()),(r=M(parseFloat(I(t.val())).toFixed(2),0,1))&&t.attr("data-opacity",r)):i=w($(t.val(),!0),f.letterCase),i||(i=w(F(f.defaultValue,!0),f.letterCase)),n=function(t){var e=function(t){var e={h:0,s:0,b:0},i=Math.min(t.r,t.g,t.b),n=Math.max(t.r,t.g,t.b),o=n-i;e.b=n,e.s=0!==n?255*o/n:0,0!==e.s?t.r===n?e.h=(t.g-t.b)/o:t.g===n?e.h=2+(t.b-t.r)/o:e.h=4+(t.r-t.g)/o:e.h=-1;e.h*=60,e.h<0&&(e.h+=360);return e.s*=100/255,e.b*=100/255,e}(D(t));0===e.s&&(e.h=360);return e}(i),a=f.keywords?k.map(f.keywords.split(","),function(t){return t.toLowerCase().trim()}):[],s=""!==t.val()&&-1<k.inArray(t.val().toLowerCase(),a)?w(t.val()):S(t.val())?x(t.val()):i,e||t.val(s),f.opacity&&(o=""===t.attr("data-opacity")?1:M(parseFloat(t.attr("data-opacity")).toFixed(2),0,1),isNaN(o)&&(o=1),t.attr("data-opacity",o),h.find("span").css("opacity",String(o)),l=M(v.height()-v.height()*o,0,v.height()),y.css("top",l+"px")),"transparent"===t.val().toLowerCase()&&h.find("span").css("opacity",String(0)),h.find("span").css("backgroundColor",i),f.control){case"wheel":d=M(Math.ceil(.75*n.s),0,p.height()/2),u=n.h*Math.PI/180,c=M(75-Math.cos(u)*d,0,p.width()),l=M(75-Math.sin(u)*d,0,p.height()),_.css({top:l+"px",left:c+"px"}),l=150-n.b/(100/p.height()),""===i&&(l=0),b.css("top",l+"px"),g.css("backgroundColor",z({h:n.h,s:n.s,b:100}));break;case"saturation":c=M(5*n.h/12,0,150),l=M(p.height()-Math.ceil(n.b/(100/p.height())),0,p.height()),_.css({top:l+"px",left:c+"px"}),l=M(g.height()-n.s*(g.height()/100),0,g.height()),b.css("top",l+"px"),g.css("backgroundColor",z({h:n.h,s:100,b:n.b})),m.find(".minicolors-grid-inner").css("opacity",n.s/100);break;case"brightness":c=M(5*n.h/12,0,150),l=M(p.height()-Math.ceil(n.s/(100/p.height())),0,p.height()),_.css({top:l+"px",left:c+"px"}),l=M(g.height()-n.b*(g.height()/100),0,g.height()),b.css("top",l+"px"),g.css("backgroundColor",z({h:n.h,s:n.s,b:100})),m.find(".minicolors-grid-inner").css("opacity",1-n.b/100);break;default:c=M(Math.ceil(n.s/(100/p.width())),0,p.width()),l=M(p.height()-Math.ceil(n.b/(100/p.height())),0,p.height()),_.css({top:l+"px",left:c+"px"}),l=M(g.height()-n.h/(360/g.height()),0,g.height()),b.css("top",l+"px"),p.css("backgroundColor",z({h:n.h,s:100,b:100}))}t.data("minicolors-initialized")&&C(t,s,o)}function C(t,e,i){var n,o,a,r=t.data("minicolors-settings"),s=t.data("minicolors-lastChange");if(!s||s.value!==e||s.opacity!==i){if(t.data("minicolors-lastChange",{value:e,opacity:i}),r.swatches&&0!==r.swatches.length){for(n=S(e)?x(e,!0):D(e),o=-1,a=0;a<r.swatches.length;++a)if(n.r===r.swatches[a].r&&n.g===r.swatches[a].g&&n.b===r.swatches[a].b&&n.a===r.swatches[a].a){o=a;break}t.parent().find(".minicolors-swatches .minicolors-swatch").removeClass("selected"),-1!==o&&t.parent().find(".minicolors-swatches .minicolors-swatch").eq(a).addClass("selected")}r.change&&(r.changeDelay?(clearTimeout(t.data("minicolors-changeTimeout")),t.data("minicolors-changeTimeout",setTimeout(function(){r.change.call(t.get(0),e,i)},r.changeDelay))):r.change.call(t.get(0),e,i)),t.trigger("change").trigger("input")}}function w(t,e){return"uppercase"===e?t.toUpperCase():t.toLowerCase()}function $(t,e){return(t=t.replace(/^#/g,"")).match(/^[A-F0-9]{3,6}/gi)?3!==t.length&&6!==t.length?"":(3===t.length&&e&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),"#"+t):""}function x(t,e){var i=t.replace(/[^\d,.]/g,"").split(",");return i[0]=M(parseInt(i[0],10),0,255),i[1]=M(parseInt(i[1],10),0,255),i[2]=M(parseInt(i[2],10),0,255),void 0!==i[3]&&(i[3]=M(parseFloat(i[3],10),0,1)),e?void 0!==i[3]?{r:i[0],g:i[1],b:i[2],a:i[3]}:{r:i[0],g:i[1],b:i[2]}:void 0!==i[3]&&i[3]<=1?"rgba("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")":"rgb("+i[0]+", "+i[1]+", "+i[2]+")"}function F(t,e){return S(t)?x(t):$(t,e)}function M(t,e,i){return t<e&&(t=e),i<t&&(t=i),t}function S(t){var e=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return!(!e||4!==e.length)}function I(t){return(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+(\.\d{1,2})?|\.\d{1,2})[\s+]?/i))&&6===t.length?t[4]:"1"}function j(t){return(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""}function m(t){var i=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return k.each(i,function(t,e){1===e.length&&(i[t]="0"+e)}),"#"+i.join("")}function z(t){return m(function(t){var e={},i=Math.round(t.h),n=Math.round(255*t.s/100),o=Math.round(255*t.b/100);if(0===n)e.r=e.g=e.b=o;else{var a=o,r=(255-n)*o/255,s=i%60*(a-r)/60;360===i&&(i=0),i<60?(e.r=a,e.b=r,e.g=r+s):i<120?(e.g=a,e.b=r,e.r=a-s):i<180?(e.g=a,e.r=r,e.b=r+s):i<240?(e.b=a,e.r=r,e.g=a-s):i<300?(e.b=a,e.g=r,e.r=r+s):i<360?(e.r=a,e.g=r,e.b=a-s):(e.r=0,e.g=0,e.b=0)}return{r:Math.round(e.r),g:Math.round(e.g),b:Math.round(e.b)}}(t))}function D(t){return{r:(t=parseInt(-1<t.indexOf("#")?t.substring(1):t,16))>>16,g:(65280&t)>>8,b:255&t}}k.minicolors={defaults:{animationSpeed:50,animationEasing:"swing",change:null,changeDelay:0,control:"hue",defaultValue:"",format:"hex",hide:null,hideSpeed:100,inline:!1,keywords:"",letterCase:"lowercase",opacity:!1,position:"bottom",show:null,showSpeed:100,theme:"default",swatches:[]}},k.extend(k.fn,{minicolors:function(t,e){switch(t){case"destroy":return k(this).each(function(){i(k(this))}),k(this);case"hide":return o(),k(this);case"opacity":return void 0===e?k(this).attr("data-opacity"):(k(this).each(function(){u(k(this).attr("data-opacity",e))}),k(this));case"rgbObject":return function(t){var e,i=k(t).attr("data-opacity");if(S(k(t).val()))e=x(k(t).val(),!0);else{var n=$(k(t).val(),!0);e=D(n)}if(!e)return null;void 0!==i&&k.extend(e,{a:parseFloat(i)});return e}(k(this));case"rgbString":case"rgbaString":return function(t,e){var i,n=k(t).attr("data-opacity");if(S(k(t).val()))i=x(k(t).val(),!0);else{var o=$(k(t).val(),!0);i=D(o)}if(!i)return null;void 0===n&&(n=1);return e?"rgba("+i.r+", "+i.g+", "+i.b+", "+parseFloat(n)+")":"rgb("+i.r+", "+i.g+", "+i.b+")"}(k(this),"rgbaString"===t);case"settings":return void 0===e?k(this).data("minicolors-settings"):(k(this).each(function(){var t=k(this).data("minicolors-settings")||{};i(k(this)),k(this).minicolors(k.extend(!0,t,e))}),k(this));case"show":return n(k(this).eq(0)),k(this);case"value":return void 0===e?k(this).val():(k(this).each(function(){"object"==typeof e&&null!==e?(void 0!==e.opacity&&k(this).attr("data-opacity",M(e.opacity,0,1)),e.color&&k(this).val(e.color)):k(this).val(e),u(k(this))}),k(this));default:return"create"!==t&&(e=t),k(this).each(function(){!function(e,t){var i,n,o,a,r,s,c,l=k('<div class="minicolors" />'),d=k.minicolors.defaults;if(e.data("minicolors-initialized"))return;t=k.extend(!0,{},d,t),l.addClass("minicolors-theme-"+t.theme).toggleClass("minicolors-with-opacity",t.opacity),void 0!==t.position&&k.each(t.position.split(" "),function(){l.addClass("minicolors-position-"+this)});n="rgb"===t.format?t.opacity?"25":"20":t.keywords?"11":"7";e.addClass("minicolors-input").data("minicolors-initialized",!1).data("minicolors-settings",t).prop("size",n).wrap(l).after('<div class="minicolors-panel minicolors-slider-'+t.control+'"><div class="minicolors-slider minicolors-sprite"><div class="minicolors-picker"></div></div><div class="minicolors-opacity-slider minicolors-sprite"><div class="minicolors-picker"></div></div><div class="minicolors-grid minicolors-sprite"><div class="minicolors-grid-inner"></div><div class="minicolors-picker"><div></div></div></div></div>'),t.inline||(e.after('<span class="minicolors-swatch minicolors-sprite minicolors-input-swatch"><span class="minicolors-swatch-color"></span></span>'),e.next(".minicolors-input-swatch").on("click",function(t){t.preventDefault(),e.trigger("focus")}));if((s=e.parent().find(".minicolors-panel")).on("selectstart",function(){return!1}).end(),t.swatches&&0!==t.swatches.length)for(s.addClass("minicolors-with-swatches"),o=k('<ul class="minicolors-swatches"></ul>').appendTo(s),c=0;c<t.swatches.length;++c)a="object"==typeof t.swatches[c]?(i=t.swatches[c].name,t.swatches[c].color):(i="",t.swatches[c]),a=S(r=a)?x(a,!0):D($(a,!0)),k('<li class="minicolors-swatch minicolors-sprite"><span class="minicolors-swatch-color"></span></li>').attr("title",i).appendTo(o).data("swatch-color",r).find(".minicolors-swatch-color").css({backgroundColor:"transparent"!==r?m(a):"transparent",opacity:String(a.a)}),t.swatches[c]=a;t.inline&&e.parent().addClass("minicolors-inline");u(e,!1),e.data("minicolors-initialized",!0)}(k(this),e)}),k(this)}}}),k([document]).on("mousedown.minicolors touchstart.minicolors",function(t){k(t.target).parents().add(t.target).hasClass("minicolors")||o()}).on("mousedown.minicolors touchstart.minicolors",".minicolors-grid, .minicolors-slider, .minicolors-opacity-slider",function(t){var e=k(this);t.preventDefault(),k(t.delegateTarget).data("minicolors-target",e),a(e,t,!0)}).on("mousemove.minicolors touchmove.minicolors",function(t){var e=k(t.delegateTarget).data("minicolors-target");e&&a(e,t)}).on("mouseup.minicolors touchend.minicolors",function(){k(this).removeData("minicolors-target")}).on("click.minicolors",".minicolors-swatches li",function(t){t.preventDefault();var e=k(this),i=e.parents(".minicolors").find(".minicolors-input"),n=e.data("swatch-color");q(i,n,I(n)),u(i)}).on("mousedown.minicolors touchstart.minicolors",".minicolors-input-swatch",function(t){var e=k(this).parent().find(".minicolors-input");t.preventDefault(),n(e)}).on("focus.minicolors",".minicolors-input",function(){var t=k(this);t.data("minicolors-initialized")&&n(t)}).on("blur.minicolors",".minicolors-input",function(){var t,e,i,n,o,a=k(this),r=a.data("minicolors-settings");a.data("minicolors-initialized")&&(t=r.keywords?k.map(r.keywords.split(","),function(t){return t.toLowerCase().trim()}):[],o=""!==a.val()&&-1<k.inArray(a.val().toLowerCase(),t)?a.val():null===(i=S(a.val())?x(a.val(),!0):(e=$(a.val(),!0))?D(e):null)?r.defaultValue:"rgb"===r.format?r.opacity?x("rgba("+i.r+","+i.g+","+i.b+","+a.attr("data-opacity")+")"):x("rgb("+i.r+","+i.g+","+i.b+")"):m(i),n=r.opacity?a.attr("data-opacity"):1,"transparent"===o.toLowerCase()&&(n=0),a.closest(".minicolors").find(".minicolors-input-swatch > span").css("opacity",String(n)),a.val(o),""===a.val()&&a.val(F(r.defaultValue,!0)),a.val(w(a.val(),r.letterCase)))}).on("keydown.minicolors",".minicolors-input",function(t){var e=k(this);if(e.data("minicolors-initialized"))switch(t.which){case 9:o();break;case 13:case 27:o(),e.blur()}}).on("keyup.minicolors",".minicolors-input",function(){var t=k(this);t.data("minicolors-initialized")&&u(t,!0)}).on("paste.minicolors",".minicolors-input",function(){var t=k(this);t.data("minicolors-initialized")&&setTimeout(function(){u(t,!0)},1)})}),$(document).ready(function(){$("#listing_filter select").change(function(){$("#listing_filter").submit()})}),$(document).ready(function(){$(".feedback .alert-success").delay(2e3).fadeOut(500),$(".feedback .alert-info").delay(2500).fadeOut(500),$(".feedback .alert-warning").delay(3e3).fadeOut(500),$(".feedback .alert-danger").delay(4500).fadeOut(500),$(".timeshift-blink").each(function(){var t=$(this);setInterval(function(){"hidden"==t.css("visibility")?t.css("visibility","visible"):t.css("visibility","hidden")},500)})}),$(document).ready(function(){$("ol.sortable-tree").nestedSortable({handle:"div",items:"li.sortable-item",toleranceElement:"> div",protectRoot:!0,opacity:.5,revert:100,tabSize:20,tolerance:"pointer",connectWith:".sortable-tree",relocate:function(){if(1<$("#sortable_tree_left > li").length)return!1;$("#list_root").removeClass("sortable-emptylist")}}),$("#form_sort_button_save").click(function(){$("ol.sortable-tree").nestedSortable({items:"li"}),nested=$("ol.sortable-tree").nestedSortable("toArray",{startDepthCount:0}),tree=[],$.each(nested,function(t,e){if(0<e.depth){var i={id:e.id,parent_id:e.parent_id};tree.push(i)}}),$.blockUI({message:null}),$("#form_sort_list").val(JSON.stringify(tree))})});